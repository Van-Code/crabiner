<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Browse Posts - Crabiner</title>
    <link rel="stylesheet" href="/styles/styles.css" />
    <link rel="stylesheet" href="/styles/browse.css" />
    <!-- Leaflet JS for map view -->
    <link rel="stylesheet" href="/vendor/leaflet/leaflet.css" />
    <script src="/vendor/leaflet/leaflet.js"></script>
    <style>
      .view-toggle {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .view-toggle button {
        padding: 0.5rem 1rem;
        border: 2px solid var(--primary-color);
        background: white;
        color: var(--primary-color);
        cursor: pointer;
        border-radius: 4px;
        font-weight: 500;
        transition: all 0.2s;
      }

      .view-toggle button.active {
        background: var(--primary-color);
        color: white;
      }

      .view-toggle button:hover {
        opacity: 0.8;
      }

      #mapView {
        display: none;
        width: 100%;
        height: 600px;
        border-radius: 8px;
        margin-bottom: 1rem;
      }

      .leaflet-popup-content {
        margin: 0.5rem;
      }

      .post-popup {
        max-width: 250px;
      }

      .post-popup h4 {
        margin: 0 0 0.5rem 0;
        font-size: 1rem;
      }

      .post-popup p {
        margin: 0.25rem 0;
        font-size: 0.875rem;
        color: var(--text-light);
      }

      .post-popup a {
        display: inline-block;
        margin-top: 0.5rem;
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
      }

      .post-popup a:hover {
        text-decoration: underline;
      }
      #mapView {
        height: 70vh;
        min-height: 420px;
        width: 100%;
        border-radius: 12px;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
      <div class="container nav-container">
        <div class="logo">
          <a href="/">
            <span class="logo-emoji">ü¶Äüîó</span>
            <span class="logo-text">Crabiner</span>
          </a>
        </div>

        <button
          class="hamburger-menu"
          id="hamburgerBtn"
          aria-label="Toggle menu"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>

        <div class="nav-links" id="navLinks">
          <a href="/browse.html" class="nav-link active">Browse</a>
          <a href="/guidelines.html" class="nav-link">Guidelines</a>

          <div id="authSection" class="auth-section">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>
    </nav>
    <div class="nav-overlay" id="navOverlay"></div>

    <main class="browse-page">
      <div class="container">
        <div class="page-header">
          <h1>Browse Missed Connections üíï</h1>
          <p>Find your connection or post your own!</p>
        </div>

        <!-- View Toggle -->
        <div class="view-toggle">
          <button id="listViewBtn" class="active">üìã List</button>
          <button id="mapViewBtn">üó∫Ô∏è Map</button>
        </div>

        <button class="mobile-filter-toggle" id="filterToggle">
          <span>Filters</span>
          <span class="toggle-icon">‚ñº</span>
        </button>

        <section class="filters" id="filtersSection">
          <select id="cityFilter">
            <option value="">All cities</option>
          </select>

          <button id="searchBtn">üîç Search</button>
          <button id="clearBtn" class="btn-secondary">Clear</button>
        </section>

        <!-- Popular searches -->
        <div
          id="popularSearches"
          class="popular-searches"
          style="display: none"
        >
          <p><strong>Popular searches:</strong></p>
          <div id="popularSearchesList"></div>
        </div>

        <div class="browse-with-sidebar">
          <div class="browse-main">
            <!-- Map View -->
            <div id="mapView"></div>

            <!-- List View -->
            <section id="posts" class="posts-grid">
              <p class="loading">Loading posts...</p>
            </section>

            <div class="pagination">
              <button id="prevPage" disabled>‚Üê Previous</button>
              <span id="pageInfo">Page 1</span>
              <button id="nextPage">Next ‚Üí</button>
            </div>
          </div>

          <aside class="browse-sidebar">
            <div class="sidebar-section">
              <h3>Browse by city üìç</h3>
              <div id="popularLocationsList" class="location-tags">
                <p class="loading">Loading cities...</p>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </main>

    <!-- Mobile sticky footer with browse by city -->
    <div class="mobile-sticky-footer" id="mobileFooter">
      <button class="footer-toggle" id="footerToggle">
        <span>Browse by city üìç</span>
        <span class="toggle-icon">‚ñ≤</span>
      </button>
      <div class="footer-content" id="footerContent">
        <div id="mobileLocationsList" class="location-tags">
          <p class="loading">Loading cities...</p>
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h4>ü¶Äüîó Crabiner</h4>
            <p>A safe space for sapphic missed connections</p>

            <!-- Ko-fi button -->
            <div class="kofi-container">
              <a href="https://ko-fi.com/W7W71P0PEN" target="_blank">
                <img
                  height="36"
                  style="border: 0px; height: 36px"
                  src="https://storage.ko-fi.com/cdn/kofi4.png?v=6"
                  border="0"
                  alt="Buy me a coffee at ko-fi.com"
                />
              </a>
              <p class="kofi-text">Help keep this site running! ‚òï</p>
            </div>
          </div>

          <div class="footer-section">
            <h4>Quick Links</h4>
            <a href="/browse.html">Browse Posts</a>
            <a href="/post.html">Post a Connection</a>
            <a href="/guidelines.html">Community Guidelines</a>
          </div>

          <div class="footer-section">
            <h4><a href="/browse.html">About</a></h4>
            <p>Privacy-focused ‚Ä¢ No tracking ‚Ä¢ Auto-expiring posts</p>
            <p>Made with üíï for the sapphic community</p>
          </div>
        </div>

        <div class="footer-bottom">
          <p>
            &copy; 2025 Crabiner. Built for and by queer & nonbinary folks. üè≥Ô∏è‚Äçüåà
          </p>
        </div>
      </div>
    </footer>

    <script src="/scripts/navigation.js"></script>
    <script src="/scripts/cities.js"></script>
    <script src="/scripts/auth.js"></script>
    <script src="/scripts/browse-mobile.js"></script>
    <script src="/scripts/app.js"></script>
  </body>
</html>
